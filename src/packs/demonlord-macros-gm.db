{"_id":"6PMGvBHfkWXTsLJV","name":"Request Challenge Roll","permission":{"default":0,"Sd8TaawsSgOTEPU7":3},"type":"script","flags":{},"scope":"global","command":"// GM Tool\n// Lets you request a challenge roll from the select tokens. Each token owner gets a whisper message asking them to make a roll.\n\nfunction requestRoll(token, attribute, boonsbanes) {\n    const actor = token.actor;\n    let users = game.users.filter(user => user.active);\n\n    var targets = [];\n    for (let user of users) {\n        if (actor.data.permission[user.id])\n            targets.push(user.id);\n    }\n\n    let boonsbanestext = \"\";\n    if (boonsbanes == 1)\n        boonsbanestext = boonsbanes + \" \" + game.i18n.localize('DL.DialogBoon');\n    if (boonsbanes > 1)\n        boonsbanestext = boonsbanes + \" \" + game.i18n.localize('DL.DialogBoons');\n    if (boonsbanes == -1)\n        boonsbanestext = boonsbanes.replace(\"-\", \"\") + \" \" + game.i18n.localize('DL.DialogBane');\n    if (boonsbanes < -1)\n        boonsbanestext = boonsbanes.replace(\"-\", \"\") + \" \" + game.i18n.localize('DL.DialogBanes');\n\n    var templateData = {\n        actor: actor,\n        data: {\n            attribute: {\n                value: CONFIG.DL.attributes[attribute.toLowerCase()]\n            },\n            boonsbanes: {\n                value: boonsbanes\n            },\n            boonsbanestext: {\n                value: boonsbanestext\n            }\n        }\n    };\n\n    let chatData = {\n        user: targets[0],\n        speaker: {\n            actor: actor._id,\n            token: actor.token,\n            alias: actor.name\n        }\n    };\n\n    chatData[\"whisper\"] = targets;\n\n    let template = 'systems/demonlord/templates/chat/makechallengeroll.html';\n    renderTemplate(template, templateData).then(content => {\n        chatData.content = content;\n        ChatMessage.create(chatData);\n    });\n}\n\nlet applyChanges = false;\nnew Dialog({\n    title: game.i18n.localize('DL.MacroChallengeTitle'),\n    content: `\n    <form>\n      <div class=\"form-group\">\n        <label>` + game.i18n.localize('DL.MacroChallengeChoose') + `</label>\n        <select id=\"attribute-type\" name=\"attribute-type\">\n          <option value=\"Strength\">` + game.i18n.localize('DL.AttributeStrength') + `</option>\n          <option value=\"Agility\">` + game.i18n.localize('DL.AttributeAgility') + `</option>\n          <option value=\"Intellect\">` + game.i18n.localize('DL.AttributeIntellect') + `</option>\n          <option value=\"Will\">` + game.i18n.localize('DL.AttributeWill') + `</option>\n          <option value=\"Perception\">` + game.i18n.localize('DL.CharPerception') + `</option>\n        </select>\n      </div>\n      <div class=\"form-group\">\n        <label>` + game.i18n.localize('DL.WeaponBoonsBanes') + `:</label>\n        <input type=\"text\" name=\"boonsbanes\" value=\"0\"/>\n      </div>\n    </form>\n    `,\n    buttons: {\n        yes: {\n            icon: \"<i class='fas fa-check'></i>\",\n            label: game.i18n.localize('DL.MacroChallengeRequestRoll'),\n            callback: () => applyChanges = true\n        },\n        no: {\n            icon: \"<i class='fas fa-times'></i>\",\n            label: game.i18n.localize('DL.MacroCancel')\n        },\n    },\n    default: \"yes\",\n    close: html => {\n        if (applyChanges) {\n            for (let token of canvas.tokens.controlled) {\n                let attribute = html.find('[name=\"attribute-type\"]')[0].value || \"none\";\n                let boonsbanes = html.find('[name=\"boonsbanes\"]')[0].value || \"none\";\n\n                requestRoll(token, attribute, boonsbanes);\n            }\n        }\n    }\n}).render(true);","author":"Sd8TaawsSgOTEPU7","img":"systems/demonlord/assets/icons/skills/challenge.webp","actorIds":[]}
{"_id":"IGCtWhX2NjuJc87z","name":"Apply Afflictions Macro","permission":{"default":0,"Sd8TaawsSgOTEPU7":3},"type":"script","flags":{"core":{"sourceId":"Macro.J2a9ZtLSSJhH5WjH"}},"scope":"global","command":"// GM Tool\n// Lets you apply Afflictions to all selected tokens.\n\nfunction isChecked (field) {\n  for (const token of canvas.tokens.controlled) {\n    const affliction = token.actor.data.effects.filter(\n      (e) => e.label === field.charAt(0).toUpperCase() + field.slice(1)\n    )\n\n    if (affliction.length > 0) return ' checked'\n  }\n}\n\nasync function setTokenEffects (actor) {\n  const asleep = CONFIG.DL.statusIcons.asleep\n  const blinded = CONFIG.DL.statusIcons.blinded\n  const charmed = CONFIG.DL.statusIcons.charmed\n  const compelled = CONFIG.DL.statusIcons.compelled\n  const dazed = CONFIG.DL.statusIcons.dazed\n  const deafened = CONFIG.DL.statusIcons.deafened\n  const defenseless = CONFIG.DL.statusIcons.defenseless\n  const diseased = CONFIG.DL.statusIcons.diseased\n  const fatigued = CONFIG.DL.statusIcons.fatigued\n  const frightened = CONFIG.DL.statusIcons.frightened\n  const horrified = CONFIG.DL.statusIcons.horrified\n  const grabbed = CONFIG.DL.statusIcons.grabbed\n  const immobilized = CONFIG.DL.statusIcons.immobilized\n  const impaired = CONFIG.DL.statusIcons.impaired\n  const poisoned = CONFIG.DL.statusIcons.poisoned\n  const prone = CONFIG.DL.statusIcons.prone\n  const slowed = CONFIG.DL.statusIcons.slowed\n  const stunned = CONFIG.DL.statusIcons.stunned\n  const surprised = CONFIG.DL.statusIcons.surprised\n  const unconscious = CONFIG.DL.statusIcons.unconscious\n\n  const actorData = actor.data\n\n  for (const t of canvas.tokens.controlled) {\n    if (t.scene.id === game.scenes.active.id) {\n      toggleEffect(t, actorData.data.afflictions?.asleep, asleep)\n      toggleEffect(t, actorData.data.afflictions?.blinded, blinded)\n      toggleEffect(t, actorData.data.afflictions?.charmed, charmed)\n      toggleEffect(t, actorData.data.afflictions?.compelled, compelled)\n      toggleEffect(t, actorData.data.afflictions?.dazed, dazed)\n      toggleEffect(t, actorData.data.afflictions?.deafened, deafened)\n      toggleEffect(t, actorData.data.afflictions?.defenseless, defenseless)\n      toggleEffect(t, actorData.data.afflictions?.diseased, diseased)\n      toggleEffect(t, actorData.data.afflictions?.fatigued, fatigued)\n      toggleEffect(t, actorData.data.afflictions?.frightened, frightened)\n      toggleEffect(t, actorData.data.afflictions?.horrified, horrified)\n      toggleEffect(t, actorData.data.afflictions?.grabbed, grabbed)\n      toggleEffect(t, actorData.data.afflictions?.immobilized, immobilized)\n      toggleEffect(t, actorData.data.afflictions?.impaired, impaired)\n      toggleEffect(t, actorData.data.afflictions?.poisoned, poisoned)\n      toggleEffect(t, actorData.data.afflictions?.prone, prone)\n      toggleEffect(t, actorData.data.afflictions?.slowed, slowed)\n      toggleEffect(t, actorData.data.afflictions?.stunned, stunned)\n      toggleEffect(t, actorData.data.afflictions?.surprised, surprised)\n      toggleEffect(t, actorData.data.afflictions?.unconscious, unconscious)\n    }\n  }\n}\n\nasync function toggleEffect (token, affliction, tokenIcon) {\n  const effects = token.data.actorLink\n    ? token.actor.effects\n    : token.data.actorData.effects\n\n  if (effects) {\n    const actorEffectFound = token.data.actorLink\n      ? effects.find((e) => e.data.icon === tokenIcon)\n      : effects.find((e) => e.icon === tokenIcon)\n\n    if (\n      (affliction && !actorEffectFound) ||\n      (!affliction && actorEffectFound)\n    ) {\n      const effect = CONFIG.statusEffects.find((e) => e.icon === tokenIcon)\n      await token.toggleEffect(effect)\n    }\n  }\n}\n\nlet applyChanges = false\nnew Dialog({\n  title: game.i18n.localize('DL.MacroApplyAfflicationTitle'),\n  content:\n    `\n    <form>\n      <div class=\"form-block\">\n        <ol class=\"items-list\">\n            <li>\n                <div class=\"grid grid-3col\">\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.asleep\" id=\"data.afflictions.asleep\"` +\n    isChecked('asleep') +\n    `>\n                        <div>\n                            <label for=\"data.afflictions.asleep\">\n                                Asleep\n                            </label>\n                            <div class=\"fas fa-question tooltip\">\n                            <span class=\"tooltiptext\">A sleeping creature is prone and unconscious. Another creature that can reach it can use an action to wake it up. Unless otherwise noted, taking damage removes this affliction.</span>\n</div>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.blinded\" id=\"data.afflictions.blinded\"` +\n    isChecked('blinded') +\n    `>\n                        <div>\n                            <label for=\"data.afflictions.blinded\">\n                                Blinded\n                            </label>\n                            <div class=\"fas fa-question tooltip\">\n                            <span class=\"tooltiptext\">A blinded creature cannot see. It treats its surroundings as totally obscured (see Obscurement). Other creatures make attack rolls with 1 boon against a blinded creature’s Defense or Agility. Perception challenge rolls that rely on sight automatically result in failure. Finally, the blinded creature’s Speed becomes 2 unless its normal Speed is lower.</span>\n</div>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.charmed\" id=\"data.afflictions.charmed\"` +\n    isChecked('charmed') +\n    `>\n                        <div>\n                            <label for=\"data.afflictions.charmed\">\n                                Charmed\n                            </label>\n                            <div class=\"fas fa-question tooltip\">\n                            <span class=\"tooltiptext\">A charmed creature sees the source of the affliction as a trusted friend and ally. The charmed creature cannot choose the creature that bestowed the affliction as the target of its attacks.</span>\n</div>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.compelled\" id=\"actor.data.afflictions.compelled\"` +\n    isChecked('compelled') +\n    `>\n                        <div>\n                            <label for=\"data.afflictions.compelled\">\n                                Compelled\n                            </label>\n                            <div class=\"fas fa-question tooltip\">\n                            <span class=\"tooltiptext\">A compelled creature cannot use actions or move. Instead, during each fast turn (see Combat), the creature that bestowed the affliction can force the compelled creature to move up to its Speed or to use an action. The creature that bestowed the affliction makes all decisions on the compelled creature’s behalf.</span>\n                        </div>\n</div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.dazed\" id=\"data.afflictions.dazed\"` +\n    isChecked('dazed') +\n    `>\n                        <div>\n                            <label for=\"data.afflictions.dazed\">\n                                Dazed\n                            </label>\n                            <div class=\"fas fa-question tooltip\">\n                            <span class=\"tooltiptext\">A dazed creature cannot use actions.</span>\n                        </div>\n</div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.deafened\" id=\"data.afflictions.deafened\"` +\n    isChecked('deafened') +\n    `>\n                        <div>\n                            <label for=\"data.afflictions.deafened\">\n                                Deafened\n                            </label>\n                            <div class=\"fas fa-question tooltip\">\n                            <span class=\"tooltiptext\">A deafened creature cannot hear. Perception challenge rolls made to listen automatically result in failure.</span>\n</div>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.defenseless\" id=\"data.afflictions.defenseless\"` +\n    isChecked('defenseless') +\n    `>\n                        <div>\n                            <label for=\"data.afflictions.defenseless\">\n                                Defenseless\n                            </label>\n                            <div class=\"fas fa-question tooltip\">\n                            <span class=\"tooltiptext\">A defenseless creature cannot defend itself. Its Defense is 5, it cannot use actions, and its challenge rolls using attributes result in failure. The creature can still perceive its surroundings, however, and can make Perception challenge rolls as normal.</span>\n</div>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.diseased\" id=\"data.afflictions.diseased\"` +\n    isChecked('diseased') +\n    `>\n                        <div>\n                            <label for=\"data.afflictions.diseased\">\n                                Diseased\n                            </label>\n                            <div class=\"fas fa-question tooltip\">\n                            <span class=\"tooltiptext\">A diseased creature makes all attack rolls and challenge rolls with 1 bane.</span>\n</div>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.fatigued\" id=\"data.afflictions.fatigued\"` +\n    isChecked('fatigued') +\n    `>\n                        <div>\n                            <label for=\"data.afflictions.fatigued\">\n                                Fatigued\n                            </label>\n                            <div class=\"fas fa-question tooltip\">\n                            <span class=\"tooltiptext\">A fatigued creature makes all attack rolls and challenge rolls with 1 bane.</span>\n</div>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.frightened\" id=\"data.afflictions.frightened\"` +\n    isChecked('frightened') +\n    `>\n                        <div>\n                            <label for=\"data.afflictions.frightened\">\n                                Frightened\n                            </label>\n                            <div class=\"fas fa-question tooltip\">\n                            <span class=\"tooltiptext\">A frightened creature makes attack rolls and challenge rolls with 1 bane.</span>\n</div>\n                        </div>\n                    </div>\n<div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.horrified\" id=\"data.afflictions.horrified\"` +\n    isChecked('horrified') +\n    `>\n                        <div>\n                            <label for=\"data.afflictions.horrified\">\n                                Horrified\n                            </label>\n                            <div class=\"fas fa-question tooltip\">\n                            <span class=\"tooltiptext\">A horrified creature makes attack rolls and challenge rolls with 3 banes when it can see the source of the frightened affliction.</span>\n</div>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.grabbed\" id=\"data.afflictions.grabbed\"` +\n    isChecked('grabbed') +\n    `>\n                        <div>\n                            <label for=\"data.afflictions.grabbed\">\n                                Grabbed\n                            </label>\n                            <div class=\"fas fa-question tooltip\">\n                            <span class=\"tooltiptext\">The effects of the affliction depend on the creature’s Size. If the grabbed creature’s Size is equal to or smaller than that of the creature grabbing it, the grabbed creature cannot move away from the creature that grabbed it until it removes the affliction. If the grabbed creature’s Size is larger than that of the creature grabbing it, whenever the grabbed creature moves, the creature grabbing it can choose to move with it (by clinging to the grabbed creature’s body) or end the grab. (See Grab for more information on how to grab, and Escape for how to escape a grab.)</span>\n</div>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.immobilized\" id=\"data.afflictions.immobilized\"` +\n    isChecked('immobilized') +\n    `>\n                        <div>\n                            <label for=\"data.afflictions.immobilized\">\n                                Immobilized\n                            </label>\n                            <div class=\"fas fa-question tooltip\">\n                            <span class=\"tooltiptext\">An immobilized creature has Speed 0 and cannot benefit from bonuses to Speed. Other creatures make all attack rolls against the immobilized creature with 1 boon.</span>\n</div>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.impaired\" id=\"data.afflictions.impaired\"` +\n    isChecked('impaired') +\n    `>\n                        <div>\n                            <label for=\"data.afflictions.impaired\">\n                                Impaired\n                            </label>\n                            <div class=\"fas fa-question tooltip\">\n                            <span class=\"tooltiptext\">An impaired creature makes all attack rolls and challenge rolls with 1 bane.</span>\n                        </div>\n</div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.poisoned\" id=\"data.afflictions.poisoned\"` +\n    isChecked('poisoned') +\n    `>\n                        <div>\n                            <label for=\"data.afflictions.poisoned\">\n                                Poisoned\n                            </label>\n                            <div class=\"fas fa-question tooltip\">\n                            <span class=\"tooltiptext\">A poisoned creature makes all attack rolls and challenge rolls with 1 bane.</span>\n</div>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.prone\" id=\"data.afflictions.prone\"` +\n    isChecked('prone') +\n    `>\n                        <div>\n                            <label for=\"data.afflictions.prone\">\n                                Prone\n                            </label>\n                            <div class=\"fas fa-question tooltip\">\n                            <span class=\"tooltiptext\">A prone creature lies on the ground. Other creatures can move through its space. While prone, the creature can move by crawling or can use its move to stand up. The prone creature makes Strength and Agility rolls with 1 bane. Creatures that can reach the prone creature make all attack rolls against it with 1 boon, while creatures that cannot reach it make attack rolls against its Defense with 1 bane.</span>\n                        </div>\n</div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.slowed\" id=\"data.afflictions.slowed\"` +\n    isChecked('slowed') +\n    `>\n                        <div>\n                            <label for=\"data.afflictions.slowed\">\n                                Slowed\n                            </label>\n                            <div class=\"fas fa-question tooltip\">\n                            <span class=\"tooltiptext\">A slowed creature can take only a slow turn (see Combat), its Speed is halved, and it cannot benefit from increases to Speed.</span>\n</div>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.stunned\" id=\"data.afflictions.stunned\"` +\n    isChecked('stunned') +\n    `>\n                        <div>\n                            <label for=\"data.afflictions.stunned\">\n                                Stunned\n                            </label>\n                            <div class=\"fas fa-question tooltip\">\n                            <span class=\"tooltiptext\">A stunned creature cannot move or use actions. The creature automatically gets a failure on any challenge rolls it would make. Other creatures make all attack rolls against the stunned creature with 1 boon.</span>\n                        </div>\n</div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.surprised\" id=\"data.afflictions.surprised\"` +\n    isChecked('surprised') +\n    `>\n                        <div class=\"tooltip\">\n                            <label for=\"data.afflictions.surprised\">\n                                Surprised\n                            </label>\n                            <div class=\"fas fa-question\"></div>\n                            <span class=\"tooltiptext\">A surprised creature cannot use actions, cannot move, and automatically gets a failure on any challenge rolls it would make.</span>\n                        </div>\n                    </div>\n                    <div class=\"affliction\">\n                        <input type=\"checkbox\" name=\"actor.data.afflictions.unconscious\" id=\"data.afflictions.unconscious\"` +\n    isChecked('unconscious') +\n    `>\n                        <div>\n                            <label for=\"data.afflictions.unconscious\">\n                                Unconscious\n                            </label>\n                            <div class=\"fas fa-question tooltip\">\n                            <span class=\"tooltiptext\">An unconscious creature is unable to act, move, or perceive its surroundings. The creature’s Defense is 5. It cannot use actions or move, and all its challenge rolls result in failure.</span>\n</div>\n                        </div>\n                    </div>\n                </div>\n            </li>\n        </ol>\n    </div>\n    </form>\n    `,\n  buttons: {\n    yes: {\n      icon: \"<i class='fas fa-check'></i>\",\n      label: game.i18n.localize('DL.MacroApplyAfflicationTitle'),\n      callback: () => (applyChanges = true)\n    },\n    no: {\n      icon: \"<i class='fas fa-times'></i>\",\n      label: game.i18n.localize('DL.MacroCancel')\n    }\n  },\n  default: 'yes',\n  close: (html) => {\n    if (applyChanges) {\n      for (const token of canvas.tokens.controlled) {\n        if (html.find('[name=\"actor.data.afflictions.asleep\"]')[0].checked) {\n          token.actor.data.data.afflictions.asleep = true\n          token.actor.data.data.afflictions.prone = true\n          token.actor.data.data.afflictions.unconscious = true\n        } else {\n          token.actor.data.data.afflictions.asleep = false\n          token.actor.data.data.afflictions.prone = false\n          token.actor.data.data.afflictions.unconscious = false\n        }\n        if (html.find('[name=\"actor.data.afflictions.blinded\"]')[0].checked) {\n          token.actor.data.data.afflictions.blinded = true\n        } else {\n          token.actor.data.data.afflictions.blinded = false\n        }\n        if (html.find('[name=\"actor.data.afflictions.charmed\"]')[0].checked) {\n          token.actor.data.data.afflictions.charmed = true\n        } else {\n          token.actor.data.data.afflictions.charmed = false\n        }\n        if (html.find('[name=\"actor.data.afflictions.compelled\"]')[0].checked) {\n          token.actor.data.data.afflictions.compelled = true\n        } else {\n          token.actor.data.data.afflictions.compelled = false\n        }\n        if (html.find('[name=\"actor.data.afflictions.dazed\"]')[0].checked) {\n          token.actor.data.data.afflictions.dazed = true\n        } else {\n          token.actor.data.data.afflictions.dazed = false\n        }\n        if (html.find('[name=\"actor.data.afflictions.deafened\"]')[0].checked) {\n          token.actor.data.data.afflictions.deafened = true\n        } else {\n          token.actor.data.data.afflictions.deafened = false\n        }\n        if (\n          html.find('[name=\"actor.data.afflictions.defenseless\"]')[0].checked\n        ) {\n          token.actor.data.data.afflictions.defenseless = true\n        } else {\n          token.actor.data.data.afflictions.defenseless = false\n        }\n        if (html.find('[name=\"actor.data.afflictions.diseased\"]')[0].checked) {\n          token.actor.data.data.afflictions.diseased = true\n        } else {\n          token.actor.data.data.afflictions.diseased = false\n        }\n        if (html.find('[name=\"actor.data.afflictions.fatigued\"]')[0].checked) {\n          token.actor.data.data.afflictions.fatigued = true\n        } else {\n          token.actor.data.data.afflictions.fatigued = false\n        }\n        if (\n          html.find('[name=\"actor.data.afflictions.frightened\"]')[0].checked\n        ) {\n          token.actor.data.data.afflictions.frightened = true\n        } else {\n          token.actor.data.data.afflictions.frightened = false\n        }\n        if (html.find('[name=\"actor.data.afflictions.horrified\"]')[0].checked) {\n          token.actor.data.data.afflictions.horrified = true\n        } else {\n          token.actor.data.data.afflictions.horrified = false\n        }\n        if (html.find('[name=\"actor.data.afflictions.grabbed\"]')[0].checked) {\n          token.actor.data.data.afflictions.grabbed = true\n        } else {\n          token.actor.data.data.afflictions.grabbed = false\n        }\n        if (\n          html.find('[name=\"actor.data.afflictions.immobilized\"]')[0].checked\n        ) {\n          token.actor.data.data.afflictions.immobilized = true\n        } else {\n          token.actor.data.data.afflictions.immobilized = false\n        }\n        if (html.find('[name=\"actor.data.afflictions.impaired\"]')[0].checked) {\n          token.actor.data.data.afflictions.impaired = true\n        } else {\n          token.actor.data.data.afflictions.impaired = false\n        }\n        if (html.find('[name=\"actor.data.afflictions.poisoned\"]')[0].checked) {\n          token.actor.data.data.afflictions.poisoned = true\n        } else {\n          token.actor.data.data.afflictions.poisoned = false\n        }\n        if (html.find('[name=\"actor.data.afflictions.prone\"]')[0].checked) {\n          token.actor.data.data.afflictions.prone = true\n        } else {\n          token.actor.data.data.afflictions.prone = false\n        }\n        if (html.find('[name=\"actor.data.afflictions.slowed\"]')[0].checked) {\n          token.actor.data.data.afflictions.slowed = true\n          token.actor.data.data.fastturn = false\n        } else {\n          token.actor.data.data.afflictions.slowed = false\n        }\n        if (html.find('[name=\"actor.data.afflictions.stunned\"]')[0].checked) {\n          token.actor.data.data.afflictions.stunned = true\n        } else {\n          token.actor.data.data.afflictions.stunned = false\n        }\n        if (html.find('[name=\"actor.data.afflictions.surprised\"]')[0].checked) {\n          token.actor.data.data.afflictions.surprised = true\n        } else {\n          token.actor.data.data.afflictions.surprised = false\n        }\n        if (\n          html.find('[name=\"actor.data.afflictions.unconscious\"]')[0].checked\n        ) {\n          token.actor.data.data.afflictions.unconscious = true\n        } else {\n          token.actor.data.data.afflictions.unconscious = false\n        }\n\n        setTokenEffects(token.actor)\n      }\n    }\n  }\n}).render(true)","author":"Sd8TaawsSgOTEPU7","img":"systems/demonlord/assets/icons/skills/heart.webp","actorIds":[]}
{"_id":"LpxoIW6QlGVq7CAq","name":"Wealth Manager","permission":{"default":0,"Sd8TaawsSgOTEPU7":3},"type":"script","flags":{"core":{"sourceId":"Macro.xKTENMaysKHTZa6j"}},"scope":"global","command":"//Wealth Manager\nmain();\n\nfunction main() {\n  let playersNames = []\n  let players = game.users.filter((t) => t.data.role != 4)\n  players.forEach( (p) => {\n    const actor = game.actors.get(p.data?.character)\n    playersNames.push(actor.data.name);\n  }); \n  \n  let playerNameList;\n  let currentWealthList = '';\n  let playerSelected;\n  if (actor) {\n    playerSelected = canvas.tokens.controlled[0].actor.name;        \n    playerNameList = `<option value=\"everyone\">` + game.i18n.localize('DL.MacroWealthManager.Everyone') + `</option>`;  \n  } else {\n    playerNameList = `<option value=\"everyone\" selected>` + game.i18n.localize('DL.MacroWealthManager.Everyone') + `</option>`;  \n  }    \n  playersNames.map((el) => {      \n    if (el===playerSelected) {\n      playerNameList += `<option value=\"${el}\" selected>${el}</option>`;\n    } else {\n      playerNameList += `<option value=\"${el}\">${el}</option>`;      \n    }    \n  });\n\n  let currentWealth = checkWealth();\n  for (let i = 0; i < currentWealth.length; i++) {\n    currentWealthList += '<li style=\"margin-bottom: 5px\"><b>' + currentWealth[i][0] + ' [' + currentWealth[i][1] + ']</b><br/><b>GC:</b> ' + currentWealth[i][2] + ', <b>SS:</b> ' + currentWealth[i][3] + ', <b>CP:</b> ' + currentWealth[i][4] + ', <b>Bits:</b> ' + currentWealth[i][5] +'</li>';\n  }  \n\n  let template = `\n  <h2>` + game.i18n.localize('DL.MacroWealthManager.Choose') + `</h2>\n  <p><b>` + game.i18n.localize('DL.MacroWealthManager.Character') + `</b> <select id=\"playerName\" style=\"width: 200px\">${playerNameList}</select></p>\n  <p>\n    <b>` + game.i18n.localize('DL.MacroWealthManager.AddSubtract') + `</b><br/>\n<label for=\"gc\">` + game.i18n.localize('DL.MacroWealthManager.CoinsGC') + `</label>\n<input id=\"gc\" type=\"number\" min=\"-10\" max=\"10\" style=\"width: 40px; box-sizing: border-box;border: none;background-color: rgba(0, 0, 0, 0.1);color: black; text-align: center; margin-right:10px\" value=0>\n<label for=\"ss\">` + game.i18n.localize('DL.MacroWealthManager.CoinsSS') + `</label>\n<input id=\"ss\" type=\"number\" min=\"-10\" max=\"10\" style=\"width: 40px; box-sizing: border-box;border: none;background-color: rgba(0, 0, 0, 0.1);color: black; text-align: center; margin-right:10px\" value=0>\n<label for=\"cp\">` + game.i18n.localize('DL.MacroWealthManager.CoinsCP') + `</label>\n<input id=\"cp\" type=\"number\" min=\"-10\" max=\"10\" style=\"width: 40px; box-sizing: border-box;border: none;background-color: rgba(0, 0, 0, 0.1);color: black; text-align: center; margin-right:10px\" value=0>\n<label for=\"bits\">` + game.i18n.localize('DL.MacroWealthManager.CoinsBits') + `</label>\n<input id=\"bits\" type=\"number\" min=\"-10\" max=\"10\" style=\"width: 40px; box-sizing: border-box;border: none;background-color: rgba(0, 0, 0, 0.1);color: black; text-align: center; \" value=0>\n  </p>    \n<br/>\n  <h2>` + game.i18n.localize('DL.MacroWealthManager.CurrentWealth') + `</h2>\n  <ul>\n    ${currentWealthList}\n  </ul>\n  `;\n  \n  new Dialog({\n    title: game.i18n.localize('DL.MacroWealthManager.DialogTitle'),\n    content: template,\n    buttons: {\n      ok: {\n        label: game.i18n.localize('DL.MacroWealthManager.ButtonApply'),\n        callback: async (html) => {\n          coinmanager(html);\n        },\n      },\n      cancel: {\n        label: game.i18n.localize('DL.MacroWealthManager.ButtonCancel'),\n      },\n    },\n  }).render(true);\n}\n\nasync function coinmanager(html){\n  let playerName = html.find(\"#playerName\")[0].value;\n  let gc = html.find(\"#gc\")[0].value; \n  let ss = html.find(\"#ss\")[0].value; \n  let cp = html.find(\"#cp\")[0].value; \n  let bits = html.find(\"#bits\")[0].value;  \n  if (playerName=='everyone') {    \n    updateAllWealth(gc, ss, cp, bits);\n  } else { \n    updateWealth(playerName, gc, ss, cp, bits);\n  }\n}\n\nasync function updateWealth(playerName, gc, ss, cp, bits) {\n  let actors = [];\n  let players = game.users.filter((t) => t.data.role != 4);\n  players.forEach( (p) => {\n    const actor = game.actors.get(p.data.character)\n\n    if (actor.data.name === playerName)\n      actors.push(actor);\n  });\n\n  let currentGC = parseInt(actors[0].data.data.wealth.gc);\n  let currentSS = parseInt(actors[0].data.data.wealth.ss);\n  let currentCP = parseInt(actors[0].data.data.wealth.cp);\n  let currentBits = parseInt(actors[0].data.data.wealth.bits);\n\n  await actors[0].update(\n  {\n    'data.wealth.gc': currentGC + parseInt(gc),\n    'data.wealth.ss': currentSS + parseInt(ss),\n    'data.wealth.cp': currentCP + parseInt(cp),\n    'data.wealth.bits': currentBits + parseInt(bits)\n  });\n  expMessage(actors[0].data.name, gc, ss, cp, bits);\n}\n\nfunction updateAllWealth(gc, ss, cp, bits) {\n  let players = game.users.filter((t) => t.data.role != 4);\n  players.forEach( (p) => {\n    const actor = game.actors.get(p.data.character)\n\n    let currentGC = parseInt(actor.data.data.wealth.gc);\n    let currentSS = parseInt(actor.data.data.wealth.ss);\n    let currentCP = parseInt(actor.data.data.wealth.cp);\n    let currentBits = parseInt(actor.data.data.wealth.bits);\n\n    actor.update(\n    {\n      'data.wealth.gc': currentGC + parseInt(gc),\n      'data.wealth.ss': currentSS + parseInt(ss),\n      'data.wealth.cp': currentCP + parseInt(cp),\n      'data.wealth.bits': currentBits + parseInt(bits)\n    });\n\n    expMessage(actor.data.name, gc, ss, cp, bits);\n  });\n}\n\nfunction checkWealth() {\n  let wealth = [];\n  let characters = game.users.filter((t) => t.data.role != 4)\n  characters.forEach( (c) => {\n    const actor = game.actors.get(c.data.character)\n    wealth.push([c.data.name, actor.data.name, actor.data.data.wealth.gc, actor.data.data.wealth.ss, actor.data.data.wealth.cp, actor.data.data.wealth.bits]);\n  }); \n  return wealth;\n}\n\nfunction expMessage(player, gc, ss, cp, bits) {\n  let message = `<h2>${player}</h2>`;  \n  message += `\n  <div>\n\n    <span><h4>Wealth Update:</h4>\n<b>${gc}</b> GC</b><br/>\n<b>${ss}</b> SS</b><br/>\n<b>${cp}</b> CP</b><br/>\n<b>${bits}</b> Bits</b><br/>\n</span>\n  </div>     \n  `;  \n  let chatData = {\n    user: game.user._id,\n    speaker: ChatMessage.getSpeaker(),\n    content: message    \n  };  \n  ChatMessage.create(chatData, {});\n}","author":"Sd8TaawsSgOTEPU7","img":"icons/commodities/currency/coins-assorted-mix-copper-silver-gold.webp","actorIds":[]}
{"_id":"m3RJhHOGDUTIQkuU","name":"Request Initiative Roll","permission":{"default":0,"Sd8TaawsSgOTEPU7":3},"type":"script","flags":{},"scope":"global","command":"// GM Tool\n// Lets you request a Initiative Roll from the selected tokens. Each token owner gets a whisper message asking them to make a roll.\n\nfunction requestInitRoll(token) {\n    const actor = token.actor;\n    let users = game.users.filter(user => user.active);\n\n    var targets = [];\n    for (let user of users) {\n        if (actor.data.permission[user.id])\n            targets.push(user.id);\n    }\n\n    var templateData = {\n        actor: actor\n    };\n\n    let chatData = {\n        user: targets[0],\n        speaker: {\n            actor: actor._id,\n            token: actor.token,\n            alias: actor.name\n        }\n    };\n\n    chatData[\"whisper\"] = targets;\n\n    let template = 'systems/demonlord/templates/chat/makeinitroll.html';\n    renderTemplate(template, templateData).then(content => {\n        chatData.content = content;\n        ChatMessage.create(chatData);\n    });\n}\n\nfor (let token of canvas.tokens.controlled) {\n    requestInitRoll(token);\n}","author":"Sd8TaawsSgOTEPU7","img":"icons/svg/d20.svg","actorIds":[]}
{"_id":"LpxoIW6QlGVq7CAq","name":"Wealth Manager","permission":{"default":0,"Sd8TaawsSgOTEPU7":3},"type":"script","flags":{"core":{"sourceId":"Macro.xKTENMaysKHTZa6j"}},"scope":"global","command":"// Wealth Manager\nmain()\n\nfunction main () {\n  const playersNames = []\n  const players = game.users.filter((t) => t.data.role != 4)\n  players.forEach((p) => {\n    const actor = game.actors.get(p.data?.character)\n    if (actor)\n      playersNames.push(actor.data?.name)\n  })\n\n  let playerNameList\n  let currentWealthList = ''\n  let playerSelected\n  if (actor) {\n    playerSelected = canvas.tokens.controlled[0].actor.name\n    playerNameList =\n      '<option value=\"everyone\">' +\n      game.i18n.localize('DL.MacroWealthManager.Everyone') +\n      '</option>'\n  } else {\n    playerNameList =\n      '<option value=\"everyone\" selected>' +\n      game.i18n.localize('DL.MacroWealthManager.Everyone') +\n      '</option>'\n  }\n  playersNames.map((el) => {\n    if (el === playerSelected) {\n      playerNameList += `<option value=\"${el}\" selected>${el}</option>`\n    } else {\n      playerNameList += `<option value=\"${el}\">${el}</option>`\n    }\n  })\n\n  const currentWealth = checkWealth()\n  for (let i = 0; i < currentWealth.length; i++) {\n    currentWealthList +=\n      '<li style=\"margin-bottom: 5px\"><b>' +\n      currentWealth[i][0] +\n      ' [' +\n      currentWealth[i][1] +\n      ']</b><br/><b>GC:</b> ' +\n      currentWealth[i][2] +\n      ', <b>SS:</b> ' +\n      currentWealth[i][3] +\n      ', <b>CP:</b> ' +\n      currentWealth[i][4] +\n      ', <b>Bits:</b> ' +\n      currentWealth[i][5] +\n      '</li>'\n  }\n\n  const template =\n    `\n  <h2>` +\n    game.i18n.localize('DL.MacroWealthManager.Choose') +\n    `</h2>\n  <p><b>` +\n    game.i18n.localize('DL.MacroWealthManager.Character') +\n    `</b> <select id=\"playerName\" style=\"width: 200px\">${playerNameList}</select></p>\n  <p>\n    <b>` +\n    game.i18n.localize('DL.MacroWealthManager.AddSubtract') +\n    `</b><br/>\n<label for=\"gc\">` +\n    game.i18n.localize('DL.MacroWealthManager.CoinsGC') +\n    `</label>\n<input id=\"gc\" type=\"number\" min=\"-10\" max=\"10\" style=\"width: 40px; box-sizing: border-box;border: none;background-color: rgba(0, 0, 0, 0.1);color: black; text-align: center; margin-right:10px\" value=0>\n<label for=\"ss\">` +\n    game.i18n.localize('DL.MacroWealthManager.CoinsSS') +\n    `</label>\n<input id=\"ss\" type=\"number\" min=\"-10\" max=\"10\" style=\"width: 40px; box-sizing: border-box;border: none;background-color: rgba(0, 0, 0, 0.1);color: black; text-align: center; margin-right:10px\" value=0>\n<label for=\"cp\">` +\n    game.i18n.localize('DL.MacroWealthManager.CoinsCP') +\n    `</label>\n<input id=\"cp\" type=\"number\" min=\"-10\" max=\"10\" style=\"width: 40px; box-sizing: border-box;border: none;background-color: rgba(0, 0, 0, 0.1);color: black; text-align: center; margin-right:10px\" value=0>\n<label for=\"bits\">` +\n    game.i18n.localize('DL.MacroWealthManager.CoinsBits') +\n    `</label>\n<input id=\"bits\" type=\"number\" min=\"-10\" max=\"10\" style=\"width: 40px; box-sizing: border-box;border: none;background-color: rgba(0, 0, 0, 0.1);color: black; text-align: center; \" value=0>\n  </p>    \n<br/>\n  <h2>` +\n    game.i18n.localize('DL.MacroWealthManager.CurrentWealth') +\n    `</h2>\n  <ul>\n    ${currentWealthList}\n  </ul>\n  `\n\n  new Dialog({\n    title: game.i18n.localize('DL.MacroWealthManager.DialogTitle'),\n    content: template,\n    buttons: {\n      ok: {\n        label: game.i18n.localize('DL.MacroWealthManager.ButtonApply'),\n        callback: async (html) => {\n          coinmanager(html)\n        }\n      },\n      cancel: {\n        label: game.i18n.localize('DL.MacroWealthManager.ButtonCancel')\n      }\n    }\n  }).render(true)\n}\n\nasync function coinmanager (html) {\n  const playerName = html.find('#playerName')[0].value\n  const gc = html.find('#gc')[0].value\n  const ss = html.find('#ss')[0].value\n  const cp = html.find('#cp')[0].value\n  const bits = html.find('#bits')[0].value\n  if (playerName == 'everyone') {\n    updateAllWealth(gc, ss, cp, bits)\n  } else {\n    updateWealth(playerName, gc, ss, cp, bits)\n  }\n}\n\nasync function updateWealth (playerName, gc, ss, cp, bits) {\n  const actors = []\n  const players = game.users.filter((t) => t.data.role != 4)\n  players.forEach((p) => {\n    const actor = game.actors.get(p.data?.character)\n\n    if (actor && actor.data?.name === playerName) actors.push(actor)\n  })\n\n  const currentGC = parseInt(actors[0].data.data.wealth.gc)\n  const currentSS = parseInt(actors[0].data.data.wealth.ss)\n  const currentCP = parseInt(actors[0].data.data.wealth.cp)\n  const currentBits = parseInt(actors[0].data.data.wealth.bits)\n\n  await actors[0].update({\n    'data.wealth.gc': currentGC + parseInt(gc),\n    'data.wealth.ss': currentSS + parseInt(ss),\n    'data.wealth.cp': currentCP + parseInt(cp),\n    'data.wealth.bits': currentBits + parseInt(bits)\n  })\n  expMessage(actors[0].data?.name, gc, ss, cp, bits)\n}\n\nfunction updateAllWealth (gc, ss, cp, bits) {\n  const players = game.users.filter((t) => t.data.role != 4)\n  players.forEach((p) => {\n    const actor = game.actors.get(p.data?.character)\n\n    if (actor) {\n      const currentGC = parseInt(actor.data.data.wealth.gc)\n      const currentSS = parseInt(actor.data.data.wealth.ss)\n      const currentCP = parseInt(actor.data.data.wealth.cp)\n      const currentBits = parseInt(actor.data.data.wealth.bits)\n\n      actor.update({\n        'data.wealth.gc': currentGC + parseInt(gc),\n        'data.wealth.ss': currentSS + parseInt(ss),\n        'data.wealth.cp': currentCP + parseInt(cp),\n        'data.wealth.bits': currentBits + parseInt(bits)\n      })\n\n      expMessage(actor.data?.name, gc, ss, cp, bits)\n    }\n  })\n}\n\nfunction checkWealth () {\n  const wealth = []\n  const characters = game.users.filter((t) => t.data.role != 4)\n  characters.forEach((c) => {\n    const actor = game.actors.get(c.data?.character)\n\n    if (actor) {\n      wealth.push([\n        c.data.name,\n        actor.data.name,\n        actor.data.data.wealth.gc,\n        actor.data.data.wealth.ss,\n        actor.data.data.wealth.cp,\n        actor.data.data.wealth.bits\n      ])\n    }\n  })\n  return wealth\n}\n\nfunction expMessage (player, gc, ss, cp, bits) {\n  let message = `<h2>${player}</h2>`\n  message += `\n  <div>\n\n    <span><h4>Wealth Update:</h4>\n<b>${gc}</b> GC</b><br/>\n<b>${ss}</b> SS</b><br/>\n<b>${cp}</b> CP</b><br/>\n<b>${bits}</b> Bits</b><br/>\n</span>\n  </div>     \n  `\n  const chatData = {\n    user: game.user._id,\n    speaker: ChatMessage.getSpeaker(),\n    content: message\n  }\n  ChatMessage.create(chatData, {})\n}","author":"Sd8TaawsSgOTEPU7","img":"icons/commodities/currency/coins-assorted-mix-copper-silver-gold.webp","actorIds":[]}
